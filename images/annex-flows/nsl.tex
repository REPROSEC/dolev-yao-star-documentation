
        \begin{tikzpicture}[]
        \pgfdeclarelayer{arrows}
        \pgfdeclarelayer{groups}
        \pgfdeclarelayer{markers}
        \pgfsetlayers{groups,arrows,main,markers}
        
        % MATRIX
        \matrix [column sep={0.35\linewidth,between origins}, row sep=0.3ex]
        {
        \node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-0){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-0){};\node[annex_matrix_dummy_height,minimum height=5ex,anchor=center]{};\node[annex_matrix_dummy_height,minimum height=5ex,anchor=center]{};\\
\node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-1){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-1){};\node[annex_matrix_dummy_height,minimum height=3ex,anchor=center]{};\\
\node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-2){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-2){};\node[annex_matrix_dummy_height,minimum height=2ex+2ex,anchor=south,yshift=-1ex]{};\\
\node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-3){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-3){};\node[annex_matrix_dummy_height,minimum height=3ex,anchor=center]{};\\
\node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-4){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-4){};\node[annex_matrix_dummy_height,minimum height=2ex+2ex,anchor=south,yshift=-1ex]{};\\
\node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-5){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-5){};\node[annex_matrix_dummy_height,minimum height=2ex+2ex,anchor=south,yshift=-1ex]{};\\
\node[annex_matrix_node,inner sep=0,outer sep=0](pos-0-6){}; &\node[annex_matrix_node,inner sep=0,outer sep=0](pos-1-6){};\node[annex_matrix_dummy_height,minimum height=5ex,anchor=center]{};\node[annex_matrix_dummy_height,minimum height=5ex,anchor=center]{};\\
};

% MAIN LAYER

% drawing node of type Protocol in matrix line 0 with attributes: {'annexid': 'Protocol_1', 'parties': [<Party_2>, <Party_3>], 'steps': [<Parallel_4>, <Action_5>, <GenericMessage_6>, <Action_7>, <GenericMessage_8>, <GenericMessage_9>, <Parallel_10>], 'options': {'colsep': '0.35\\linewidth', 'rowsep': '0.3ex', 'enumerate': '\\setcounter{protostep}{%d}\\protostep{nsl-example:%s} ', 'styles': [], 'tex_intro': ''}, 'line': 0, 'length': 7, 'columns': [{'num': 0}, {'num': 1}], 'protocol': <Protocol_1>}


% drawing node of type Parallel in matrix line 0 with attributes: {'annexid': 'Parallel_4', 'steps': [<StartParty_11>, <StartParty_12>], 'line': 0, 'length': 1, 'protocol': <Protocol_1>}


% drawing node of type StartParty in matrix line 0 with attributes: {'annexid': 'StartParty_11', 'party': <Party_2>, 'line': 0, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['StartParty_11_0'], 'node_name': 'StartParty_11_0', 'end': <EndParty_13>, 'lifeline_segments': [(0, 12, 'annex_lifeline')]}
\node[name=StartParty_11_0,annex_start_party_box,] at (pos-0-0) {Alice};

% drawing node of type StartParty in matrix line 0 with attributes: {'annexid': 'StartParty_12', 'party': <Party_3>, 'line': 0, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['StartParty_12_0'], 'node_name': 'StartParty_12_0', 'end': <EndParty_14>, 'lifeline_segments': [(0, 12, 'annex_lifeline')]}
\node[name=StartParty_12_0,annex_start_party_box,] at (pos-1-0) {Bob};

% drawing node of type Action in matrix line 1 with attributes: {'annexid': 'Action_5', 'party': <Party_2>, 'id': 'gen-nonce', 'label': 'Generate a new nonce $n_A$', 'line': 1, 'protocol': <Protocol_1>, '_counter': 1, 'node_name_counter': 1, '_affecting_nodes': ['Action_5_0'], 'node_name': 'Action_5_0'}
\node[annex_action,name=Action_5_0] at (pos-0-1) {\setcounter{protostep}{0}\protostep{nsl-example:gen-nonce} \contour{white}{Generate a new nonce $n_A$}};

% drawing node of type GenericMessage in matrix line 2 with attributes: {'annexid': 'GenericMessage_6', 'src': <Party_2>, 'dest': <Party_3>, 'caption': '$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$', 'id': 'online-msg1', 'line': 2, 'protocol': <Protocol_1>, '_counter': 2, 'text_above': '$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$', 'text_below': '', '_affecting_nodes': ['pos-0-2', 'pos-1-2']}


% drawing node of type Action in matrix line 3 with attributes: {'annexid': 'Action_7', 'party': <Party_3>, 'id': 'gen-nonce-bob', 'label': 'Generate a new nonce $n_B$', 'line': 3, 'protocol': <Protocol_1>, '_counter': 3, 'node_name_counter': 1, '_affecting_nodes': ['Action_7_0'], 'node_name': 'Action_7_0'}
\node[annex_action,name=Action_7_0] at (pos-1-3) {\setcounter{protostep}{2}\protostep{nsl-example:gen-nonce-bob} \contour{white}{Generate a new nonce $n_B$}};

% drawing node of type GenericMessage in matrix line 4 with attributes: {'annexid': 'GenericMessage_8', 'src': <Party_3>, 'dest': <Party_2>, 'caption': '$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$', 'id': 'nonces-bob-alice', 'line': 4, 'protocol': <Protocol_1>, '_counter': 4, 'text_above': '$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$', 'text_below': '', '_affecting_nodes': ['pos-1-4', 'pos-0-4']}


% drawing node of type GenericMessage in matrix line 5 with attributes: {'annexid': 'GenericMessage_9', 'src': <Party_2>, 'dest': <Party_3>, 'caption': '$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$', 'line': 5, 'protocol': <Protocol_1>, '_counter': 5, 'text_above': '$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$', 'text_below': '', '_affecting_nodes': ['pos-0-5', 'pos-1-5']}


% drawing node of type Parallel in matrix line 6 with attributes: {'annexid': 'Parallel_10', 'steps': [<EndParty_13>, <EndParty_14>], 'line': 6, 'length': 1, 'protocol': <Protocol_1>}


% drawing node of type EndParty in matrix line 6 with attributes: {'annexid': 'EndParty_13', 'party': <Party_2>, 'line': 6, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['EndParty_13_0'], 'node_name': 'EndParty_13_0'}
\node[name=EndParty_13_0,annex_end_party_box,] at (pos-0-6) {Alice};

% drawing node of type EndParty in matrix line 6 with attributes: {'annexid': 'EndParty_14', 'party': <Party_3>, 'line': 6, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['EndParty_14_0'], 'node_name': 'EndParty_14_0'}
\node[name=EndParty_14_0,annex_end_party_box,] at (pos-1-6) {Bob};


% ARROWS LAYER

\begin{pgfonlayer}{arrows}% drawing node of type Protocol in matrix line 0 with attributes: {'annexid': 'Protocol_1', 'parties': [<Party_2>, <Party_3>], 'steps': [<Parallel_4>, <Action_5>, <GenericMessage_6>, <Action_7>, <GenericMessage_8>, <GenericMessage_9>, <Parallel_10>], 'options': {'colsep': '0.35\\linewidth', 'rowsep': '0.3ex', 'enumerate': '\\setcounter{protostep}{%d}\\protostep{nsl-example:%s} ', 'styles': [], 'tex_intro': ''}, 'line': 0, 'length': 7, 'columns': [{'num': 0}, {'num': 1}], 'protocol': <Protocol_1>}


% drawing node of type Parallel in matrix line 0 with attributes: {'annexid': 'Parallel_4', 'steps': [<StartParty_11>, <StartParty_12>], 'line': 0, 'length': 1, 'protocol': <Protocol_1>}


% drawing node of type StartParty in matrix line 0 with attributes: {'annexid': 'StartParty_11', 'party': <Party_2>, 'line': 0, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['StartParty_11_0'], 'node_name': 'StartParty_11_0', 'end': <EndParty_13>, 'lifeline_segments': [(0, 12, 'annex_lifeline')]}
\draw[annex_lifeline] (pos-0-0) -- (pos-0-6);

% drawing node of type StartParty in matrix line 0 with attributes: {'annexid': 'StartParty_12', 'party': <Party_3>, 'line': 0, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['StartParty_12_0'], 'node_name': 'StartParty_12_0', 'end': <EndParty_14>, 'lifeline_segments': [(0, 12, 'annex_lifeline')]}
\draw[annex_lifeline] (pos-1-0) -- (pos-1-6);

% drawing node of type Action in matrix line 1 with attributes: {'annexid': 'Action_5', 'party': <Party_2>, 'id': 'gen-nonce', 'label': 'Generate a new nonce $n_A$', 'line': 1, 'protocol': <Protocol_1>, '_counter': 1, 'node_name_counter': 1, '_affecting_nodes': ['Action_5_0'], 'node_name': 'Action_5_0', 'tex_id': '\\setcounter{protostep}{0}\\protostep{nsl-example:gen-nonce} ', 'tikz_extra_style': ''}


% drawing node of type GenericMessage in matrix line 2 with attributes: {'annexid': 'GenericMessage_6', 'src': <Party_2>, 'dest': <Party_3>, 'caption': '$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$', 'id': 'online-msg1', 'line': 2, 'protocol': <Protocol_1>, '_counter': 2, 'text_above': '$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$', 'text_below': '', '_affecting_nodes': ['pos-0-2', 'pos-1-2']}
%% draw message
            \draw[annex_message] (pos-0-2) to node [annex_arrow_text,above=5pt,anchor=base,pin={[pin distance=-8pt,pin edge={draw=none},annex_debug]90:online-msg1}](GenericMessage_6_0){\setcounter{protostep}{1}\protostep{nsl-example:online-msg1} \contour{white}{$\{\text{Alice}, n_A\}^\text{a}_{k_\text{Bob}}$}}  (pos-1-2); 

% drawing node of type Action in matrix line 3 with attributes: {'annexid': 'Action_7', 'party': <Party_3>, 'id': 'gen-nonce-bob', 'label': 'Generate a new nonce $n_B$', 'line': 3, 'protocol': <Protocol_1>, '_counter': 3, 'node_name_counter': 1, '_affecting_nodes': ['Action_7_0'], 'node_name': 'Action_7_0', 'tex_id': '\\setcounter{protostep}{2}\\protostep{nsl-example:gen-nonce-bob} ', 'tikz_extra_style': ''}


% drawing node of type GenericMessage in matrix line 4 with attributes: {'annexid': 'GenericMessage_8', 'src': <Party_3>, 'dest': <Party_2>, 'caption': '$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$', 'id': 'nonces-bob-alice', 'line': 4, 'protocol': <Protocol_1>, '_counter': 4, 'text_above': '$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$', 'text_below': '', '_affecting_nodes': ['pos-1-4', 'pos-0-4']}
%% draw message
            \draw[annex_message] (pos-1-4) to node [annex_arrow_text,above=5pt,anchor=base,pin={[pin distance=-8pt,pin edge={draw=none},annex_debug]90:nonces-bob-alice}](GenericMessage_8_0){\setcounter{protostep}{3}\protostep{nsl-example:nonces-bob-alice} \contour{white}{$\{\text{Bob}, n_A, n_B\}^\text{a}_{k_\text{Alice}}$}}  (pos-0-4); 

% drawing node of type GenericMessage in matrix line 5 with attributes: {'annexid': 'GenericMessage_9', 'src': <Party_2>, 'dest': <Party_3>, 'caption': '$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$', 'line': 5, 'protocol': <Protocol_1>, '_counter': 5, 'text_above': '$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$', 'text_below': '', '_affecting_nodes': ['pos-0-5', 'pos-1-5']}
%% draw message
            \draw[annex_message] (pos-0-5) to node [annex_arrow_text,above=5pt,anchor=base,pin={[pin distance=-8pt,pin edge={draw=none},annex_debug]90:}](GenericMessage_9_0){\setcounter{protostep}{4}\protostep{nsl-example:GenericMessage_9} \contour{white}{$\{n_B\}^\text{a}_{k_\text{Bob}}$}}  (pos-1-5); 

% drawing node of type Parallel in matrix line 6 with attributes: {'annexid': 'Parallel_10', 'steps': [<EndParty_13>, <EndParty_14>], 'line': 6, 'length': 1, 'protocol': <Protocol_1>}


% drawing node of type EndParty in matrix line 6 with attributes: {'annexid': 'EndParty_13', 'party': <Party_2>, 'line': 6, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['EndParty_13_0'], 'node_name': 'EndParty_13_0'}


% drawing node of type EndParty in matrix line 6 with attributes: {'annexid': 'EndParty_14', 'party': <Party_3>, 'line': 6, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['EndParty_14_0'], 'node_name': 'EndParty_14_0'}


\end{pgfonlayer}
% MARKERS LAYER

\begin{pgfonlayer}{markers}% drawing node of type Protocol in matrix line 0 with attributes: {'annexid': 'Protocol_1', 'parties': [<Party_2>, <Party_3>], 'steps': [<Parallel_4>, <Action_5>, <GenericMessage_6>, <Action_7>, <GenericMessage_8>, <GenericMessage_9>, <Parallel_10>], 'options': {'colsep': '0.35\\linewidth', 'rowsep': '0.3ex', 'enumerate': '\\setcounter{protostep}{%d}\\protostep{nsl-example:%s} ', 'styles': [], 'tex_intro': ''}, 'line': 0, 'length': 7, 'columns': [{'num': 0}, {'num': 1}], 'protocol': <Protocol_1>}



% drawing node of type Parallel in matrix line 0 with attributes: {'annexid': 'Parallel_4', 'steps': [<StartParty_11>, <StartParty_12>], 'line': 0, 'length': 1, 'protocol': <Protocol_1>}



% drawing node of type StartParty in matrix line 0 with attributes: {'annexid': 'StartParty_11', 'party': <Party_2>, 'line': 0, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['StartParty_11_0'], 'node_name': 'StartParty_11_0', 'end': <EndParty_13>, 'lifeline_segments': [(0, 12, 'annex_lifeline')]}



% drawing node of type StartParty in matrix line 0 with attributes: {'annexid': 'StartParty_12', 'party': <Party_3>, 'line': 0, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['StartParty_12_0'], 'node_name': 'StartParty_12_0', 'end': <EndParty_14>, 'lifeline_segments': [(0, 12, 'annex_lifeline')]}



% drawing node of type Action in matrix line 1 with attributes: {'annexid': 'Action_5', 'party': <Party_2>, 'id': 'gen-nonce', 'label': 'Generate a new nonce $n_A$', 'line': 1, 'protocol': <Protocol_1>, '_counter': 1, 'node_name_counter': 1, '_affecting_nodes': ['Action_5_0'], 'node_name': 'Action_5_0', 'tex_id': '\\setcounter{protostep}{0}\\protostep{nsl-example:gen-nonce} ', 'tikz_extra_style': ''}



% drawing node of type GenericMessage in matrix line 2 with attributes: {'annexid': 'GenericMessage_6', 'src': <Party_2>, 'dest': <Party_3>, 'caption': '$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$', 'id': 'online-msg1', 'line': 2, 'protocol': <Protocol_1>, '_counter': 2, 'text_above': '$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$', 'text_below': '', '_affecting_nodes': ['pos-0-2', 'pos-1-2', 'GenericMessage_6_0'], 'tikz_extra_style': '', 'node_name_counter': 1, 'tex_id': '\\setcounter{protostep}{1}\\protostep{nsl-example:online-msg1} ', 'tikz_above': 'node [annex_arrow_text,above=5pt,anchor=base,pin={[pin distance=-8pt,pin edge={draw=none},annex_debug]90:online-msg1}](GenericMessage_6_0){\\setcounter{protostep}{1}\\protostep{nsl-example:online-msg1} \\contour{white}{$\\{\\text{Alice}, n_A\\}^\\text{a}_{k_\\text{Bob}}$}}', 'tikz_below': ''}



% drawing node of type Action in matrix line 3 with attributes: {'annexid': 'Action_7', 'party': <Party_3>, 'id': 'gen-nonce-bob', 'label': 'Generate a new nonce $n_B$', 'line': 3, 'protocol': <Protocol_1>, '_counter': 3, 'node_name_counter': 1, '_affecting_nodes': ['Action_7_0'], 'node_name': 'Action_7_0', 'tex_id': '\\setcounter{protostep}{2}\\protostep{nsl-example:gen-nonce-bob} ', 'tikz_extra_style': ''}



% drawing node of type GenericMessage in matrix line 4 with attributes: {'annexid': 'GenericMessage_8', 'src': <Party_3>, 'dest': <Party_2>, 'caption': '$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$', 'id': 'nonces-bob-alice', 'line': 4, 'protocol': <Protocol_1>, '_counter': 4, 'text_above': '$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$', 'text_below': '', '_affecting_nodes': ['pos-1-4', 'pos-0-4', 'GenericMessage_8_0'], 'tikz_extra_style': '', 'node_name_counter': 1, 'tex_id': '\\setcounter{protostep}{3}\\protostep{nsl-example:nonces-bob-alice} ', 'tikz_above': 'node [annex_arrow_text,above=5pt,anchor=base,pin={[pin distance=-8pt,pin edge={draw=none},annex_debug]90:nonces-bob-alice}](GenericMessage_8_0){\\setcounter{protostep}{3}\\protostep{nsl-example:nonces-bob-alice} \\contour{white}{$\\{\\text{Bob}, n_A, n_B\\}^\\text{a}_{k_\\text{Alice}}$}}', 'tikz_below': ''}



% drawing node of type GenericMessage in matrix line 5 with attributes: {'annexid': 'GenericMessage_9', 'src': <Party_2>, 'dest': <Party_3>, 'caption': '$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$', 'line': 5, 'protocol': <Protocol_1>, '_counter': 5, 'text_above': '$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$', 'text_below': '', '_affecting_nodes': ['pos-0-5', 'pos-1-5', 'GenericMessage_9_0'], 'tikz_extra_style': '', 'node_name_counter': 1, 'tex_id': '\\setcounter{protostep}{4}\\protostep{nsl-example:GenericMessage_9} ', 'tikz_above': 'node [annex_arrow_text,above=5pt,anchor=base,pin={[pin distance=-8pt,pin edge={draw=none},annex_debug]90:}](GenericMessage_9_0){\\setcounter{protostep}{4}\\protostep{nsl-example:GenericMessage_9} \\contour{white}{$\\{n_B\\}^\\text{a}_{k_\\text{Bob}}$}}', 'tikz_below': ''}



% drawing node of type Parallel in matrix line 6 with attributes: {'annexid': 'Parallel_10', 'steps': [<EndParty_13>, <EndParty_14>], 'line': 6, 'length': 1, 'protocol': <Protocol_1>}



% drawing node of type EndParty in matrix line 6 with attributes: {'annexid': 'EndParty_13', 'party': <Party_2>, 'line': 6, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['EndParty_13_0'], 'node_name': 'EndParty_13_0'}



% drawing node of type EndParty in matrix line 6 with attributes: {'annexid': 'EndParty_14', 'party': <Party_3>, 'line': 6, 'protocol': <Protocol_1>, 'node_name_counter': 1, '_affecting_nodes': ['EndParty_14_0'], 'node_name': 'EndParty_14_0'}



\end{pgfonlayer}
        \end{tikzpicture}
        